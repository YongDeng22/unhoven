<!DOCTYPE html>
<html>
<head>
<meta charset="US-ASCII">
<title>UNH Oven</title>

<link rel="stylesheet"
	href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script
	src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

</head>


<body style="width: 90%; margin: 0 auto;">
	<div class="container" style="width: 100%; margin: 20px auto;">
		<h1>Recipe App Services</h1>
		<a href="index.html" class="btn btn-info">Home</a> <a
			href="create.html" class="btn btn-primary">Create</a> <a
			href="get.html" class="btn btn-primary">Find</a> <a
			href="search.html" class="btn btn-primary">Search</a> <a
			href="update.html" class="btn btn-primary">Update</a> <a
			href="get_by_user.html" class="btn btn-primary">Find by users</a>
	</div>

	<div id="recipeTable"></div>
	<div id="ingredientTable"></div>
	<div id="posterTable"></div>

</body>

<script type="text/javascript">
	$(function() {		
/* 		var url = "https://recipeservice.herokuapp.com/rest/recipe/search?query=";
 */		var url = "http://localhost:8080/unhoven/rest/recipe/search?query=";
 		
 		$.getJSON(url, function(recipes) {
			var recipeTable = $("#recipeTable");
			var htmlContent = "";
			var ingHtmlContent = "";
			
			if (recipes && recipes.length > 0) {
				htmlContent += populateTableHead(recipes[0]);
			}

			for (var x = 0; x < recipes.length; x++) {
				var recipe = recipes[x];
				var keys = Object.keys(recipe);
			    recipeTable.append("<tr>");
			    ingHtmlContent += "<p>Ingredient associated with recipe#: " + recipe["recipeId"] + "</p>";
				console.log(recipe["recipeId"]);
				for (var i in keys) {
					if (keys[i] != "ingredients" && keys[i] != "poster") {
							htmlContent += "<td style='border: solid 1px black; padding: 2px'>" + recipe[keys[i]] + "</td>";
					} else if (keys[i] == "ingredients") {
						htmlContent += "<td style='border: solid 1px black; padding: 2px'>" + getIngredientIDs(recipe[keys[i]]) + "</td>";
 						ingHtmlContent += populateIngredientTabe(recipe[keys[i]]);
					} else if (keys[i] == "poster") {
						htmlContent += "<td style='border: solid 1px black; padding: 2px'>" + recipe[keys[i]]["userId"] + "</td>";
						if (x == 0) {			
							populatePosterTable(recipe[keys[i]]);
						}
					}
				}

			    htmlContent += "</tr>";
			    ingHtmlContent += "</tbody></table>";
			}
			
		   recipeTable.append(htmlContent);
		   $("#ingredientTable").append(ingHtmlContent);
		   console.log(htmlContent);
		});	
	});			


		
		function populateTableHead(tableJson) {
			var head = "";
			if (tableJson) {
				head = "<table class='table table-bordered table-hover table-responsive table-stripped' style='width:auto'><thead><tr>";
				var keys = Object.keys(tableJson);
				for (var i in keys) {
					head += "<th style='border: solid 1px black; padding: 2px; text-align:center'>" + keys[i] + "</th>";
				}
				head += "</tr></thead><tbody>";
			}
			return head;
		}
		
		
		function populateIngredientTabe(ingredients) {
			var ingredientTable = $("#ingredientTable");
			var htmlContent = "";
			if (ingredients && ingredients.length > 0) {
				htmlContent += populateTableHead(ingredients[0]);
				for (var i in ingredients) {
					htmlContent += "<tr>";
					var keys = Object.keys(ingredients[i]);
					var row = ingredients[i];
					for (var j in keys) {
						htmlContent += "<td>" + row[keys[j]] + "</td>";
					}
					htmlContent += "</tr>";
				}
			}
			return htmlContent;
		}
		
		function populatePosterTable(poster) {
			var posterTable = $("#posterTable");
			var htmlContent = "<p>Poster table</p>";
			htmlContent += populateTableHead(poster);
			if (poster) {
				htmlContent += "<tr>";
				var keys = Object.keys(poster);
				for (var i in keys) {
					htmlContent += "<td>" + poster[keys[i]] + "</td>";
				}
				htmlContent += "</tr></tbody></table>";
			}
			posterTable.append(htmlContent);
		}
		
		function getIngredientIDs(ingredients) {
			var ids = "";
			if (ingredients && ingredients.length > 0) {
				for (var i = 0; i < ingredients.length - 1; i++) {
					ids += ingredients[i]["ingredientId"] + ", ";
				}
				ids += ingredients[ingredients.length - 1]["ingredientId"];				
			}
			return ids;
		}

</script>
</html>